title = "Volcano Plot (Day-3 PCI vs sham)",
x = "log2 Fold Change",
y = "-log10(adjusted p-value)"
)
fwrite(deg, "DEG_DESeq2_day3.tsv", sep = "\t", row.names = T)
pwd
fwrite(deg, "DEG_DESeq2_day3.csv", sep = "\t", row.names = T)
install.packages("openxlsx")
library(openxlsx)
write.xlsx(deg, "DEG_DeSeq2_day3.xlsx")
View(deg)
write.xlsx(deg, "DEG_DeSeq2_day3.xlsx", row.names = T)
write.xlsx(deg, "DEG_DeSeq2_day3.xlsx", rownames = T)
write.xlsx(deg, "DEG_DeSeq2_day3.xlsx", rownames = T)
rm(list = ls())
# ---------------------------------------------------
# library requirements
# ---------------------------------------------------
library(GEOquery)
library(edgeR)
library(readr)
library(data.table)
library(ggrepel)
library(ggplot2)
# Loading the counts
count <-fread("GSE198862_137_HYC_counts.csv.gz", data.table = F)
#set rownames as the first column
row.names(count) <- count[[1]]
count<- count[,-1]
# Downloading the metadata from GEO
gse <- getGEO("GSE198862", GSEMatrix = TRUE)
metadata = pData(gse[[1]])
# creating a sample id column in metadata
metadata$sampleID <- sub("\\s*\\(.*", "",metadata$title)
# filtering low count genes
perc_keep <- 0.8
gene_keep <- rowSums(count > 0) >= ceiling(perc_keep * ncol(count))
count_tbl_low_rm <- count[gene_keep, ]
# subset of metadata
D_3_meta <- metadata[metadata$characteristics_ch1.1 %in% c("treatment: sham","treatment: PCI")& metadata$characteristics_ch1.2 == "time: 3 days", ]
D_3_count <- count_tbl_low_rm[, D_3_meta$sampleID, drop = F]
# metadata for edgeR
meta <- data.frame(
sampleID = colnames(D_3_count),
Treatment = D_3_meta$`treatment:ch1`
)
dge <- DGEList(counts = D_3_count, samples = meta)
# create a design
View(dge)
View(meta)
dge <- as.data.frame(dge)
dge <- DGEList(counts = D_3_count, samples = meta)
dge <- as.data.frame(dge)
View(dge)
dge <- DGEList(counts = D_3_count, samples = meta)
View(dge)
View(dge[["samples"]])
design <- model.matrix(~ dge$samples$Treatment)
View(design)
# Normalise library size
dge <- normLibSizes(dge)
View(dge)
View(dge[["samples"]])
dge <- estimateDisp(dge,design)
View(dge)
View(dge[["samples"]])
dge$samples$Treatment <- relevel(dge$samples$Treatment, ref = "sham")
str(dge$samples$Treatment)
levels(dge$samples$Treatment)
dge <- estimateDisp(dge,design)
dge$samples$Treatment <- factor(dge$samples$Treatment)
levels(dge$samples$Treatment)
dge$samples$Treatment <- relevel(dge$samples$Treatment, ref = "sham")
View(dge[["samples"]])
dge[["common.dispersion"]]
# Perform quasi-likelihood F-tests
fit <- glmQLFit(dge, design)
qlf <- glmQLFTest(fit, coef = 2)
View(fit)
dge <- DGEList(counts = D_3_count, samples = meta)
dge$samples$Treatment <- factor(dge$samples$Treatment)
# ---------------------------------------------------
# library requirements
# ---------------------------------------------------
library(GEOquery)
library(edgeR)
library(readr)
library(data.table)
library(ggrepel)
library(ggplot2)
# Loading the counts
count <-fread("GSE198862_137_HYC_counts.csv.gz", data.table = F)
#set rownames as the first column
row.names(count) <- count[[1]]
count<- count[,-1]
# Downloading the metadata from GEO
gse <- getGEO("GSE198862", GSEMatrix = TRUE)
metadata = pData(gse[[1]])
# creating a sample id column in metadata
metadata$sampleID <- sub("\\s*\\(.*", "",metadata$title)
# filtering low count genes
perc_keep <- 0.8
gene_keep <- rowSums(count > 0) >= ceiling(perc_keep * ncol(count))
count_tbl_low_rm <- count[gene_keep, ]
# subset of metadata
D_3_meta <- metadata[metadata$characteristics_ch1.1 %in% c("treatment: sham","treatment: PCI")& metadata$characteristics_ch1.2 == "time: 3 days", ]
D_3_count <- count_tbl_low_rm[, D_3_meta$sampleID, drop = F]
# metadata for edgeR
meta <- data.frame(
sampleID = colnames(D_3_count),
Treatment = D_3_meta$`treatment:ch1`
)
# create a DEGList object
dge <- DGEList(counts = D_3_count, samples = meta)
# Set factor + reference
dge$samples$Treatment <- factor(dge$samples$Treatment)
dge$samples$Treatment <- relevel(dge$samples$Treatment, ref = "sham")
# Design matrix
design <- model.matrix(~ dge$samples$Treatment)
# Normalize
dge <- normLibSizes(dge)
# Estimate dispersion
dge <- estimateDisp(dge, design)
# Fit model
fit <- glmQLFit(dge, design)
# Test PCI vs sham
qlf <- glmQLFTest(fit, coef = 2)
res_qlf <- topTags(qlf, n = Inf, adjust.method = "BH")
View(res_qlf)
View(res_qlf[["table"]])
res_qlf_df <- res_qlf$table
View(res_qlf_df)
edge <- res_qlf_df
library(readr)
library(ggplot2)
# Load DEG table
dega <- res_qlf_df
# Convert FDR to -log10 scale
dega$logP <- -log10(dega$FDR)
# Create significance labels
dega$significance <- "Not Sig"
dega$significance[
dega$FDR < 0.05 & dega$logFC > 1
] <- "Up"
dega$significance[
dega$FDR < 0.05 & dega$logFC < -1
] <- "Down"
# Volcano plot
ggplot(dega, aes(x = logFC, y = logP, color = significance)) +
geom_point(alpha = 0.8, size = 2) +
scale_color_manual(values = c(
"Up" = "red",
"Down" = "blue",
"Not Sig" = "grey"
)) +
geom_vline(xintercept = c(-1, 1), linetype = "dashed") +
geom_hline(yintercept = -log10(0.05), linetype = "dashed") +
theme_classic() +
labs(
title = "Volcano Plot (PCI vs Sham)",
x = "log2 Fold Change",
y = "-log10(FDR)"
)
View(D_3_meta)
View(dega)
setwd("C:/Users/nithi_eetauxx/Desktop/DEG/DEG results/EdgeR")
rm(list = ls())
# ---------------------------------------------------
# library requirements
# ---------------------------------------------------
library(GEOquery)
library(DESeq2)
library(readr)
library(data.table)
library(ggrepel)
library(ggplot2)
# Loading the counts
count <-fread("GSE198862_137_HYC_counts.csv.gz", data.table = F)
# ---------------------------------------------------
# library requirements
# ---------------------------------------------------
library(GEOquery)
library(DESeq2)
library(readr)
library(data.table)
library(ggrepel)
library(ggplot2)
# Loading the counts
count <-fread("GSE198862_137_HYC_counts.csv.gz", data.table = F)
#set rownames as the first column
row.names(count) <- count[[1]]
count<- count[,-1]
# Downloading the metadata from GEO
gse <- getGEO("GSE198862", GSEMatrix = TRUE)
metadata = pData(gse[[1]])
# creating a sample id column in metadata
metadata$sampleID <- sub("\\s*\\(.*", "",metadata$title)
# filtering low count genes
perc_keep <- 0.8
gene_keep <- rowSums(count > 0) >= ceiling(perc_keep * ncol(count))
count_tbl_low_rm <- count[gene_keep, ]
# subset of metadata
D_20_meta <- metadata[metadata$characteristics_ch1.1 %in% c("treatment: sham","treatment: PCI")& metadata$characteristics_ch1.2 == "time: 20 days", ]
D_20_count <- count_tbl_low_rm[, D_20_meta$sampleID, drop = F]
# metadata for DEseq2
meta <- data.frame(
sampleID = colnames(D_20_count),
Treatment = D_20_meta$`treatment:ch1`
)
# Experimental Design for this study
# Identifying the up & downregulated genes in 3 days sham vs PCI
# PCI == Peritoneal contamination and infection
# sham == healthy group
# DEseq2 DEG
# creating Deseq2 object
obj_deseq2 <- DESeqDataSetFromMatrix(
countData = D_20_count,
colData = meta,
design = ~ Treatment
)
# Add feature annotations
featureData <- data.frame(GeneSymbol = rownames(D_20_count))
mcols(obj_deseq2) <- DataFrame(mcols(obj_deseq2), featureData)
# set reference level and perfrom DE analysis
obj_deseq2$Treatment <- relevel(obj_deseq2$Treatment, ref = "sham")
obj_deseq2 <- DESeq(obj_deseq2)
# Refining the log2change valuse from Deseq2
resLFC <- lfcShrink(obj_deseq2, coef = "Treatment_PCI_vs_sham", type = "apeglm")
res_deseq2 <- resLFC[order(resLFC$padj),]
deg <- as.data.frame(res_deseq2)
# converting log2FC to log10 scale to make plots
deg$logP <- -log10(deg$padj)
# Adding annotations according to the log2FC
deg$significance <- "Not Sig"
# separating up and down regualted genes based on  adj.p-value
deg$significance[deg$padj < 0.05 & deg$log2FoldChange >1 ] <- "up"
deg$significance[deg$padj<0.05 & deg$log2FoldChange < -1] <- "down"
# writing the DEG in a file
fwrite(deg, "DEG_DESeq2_day3.csv", sep = "\t", row.names = T)
# plotting the DEG's
ggplot(deg, aes(x = log2FoldChange, y = logP, color = significance)) +
geom_point(alpha = 0.8, size = 2) +
scale_color_manual(values = c(
"up" = "red",
"down" = "blue",
"Not Sig" = "grey"
)) +
geom_vline(xintercept = c(-1, 1), linetype = "dashed") +
geom_hline(yintercept = -log10(0.05), linetype = "dashed") +
theme_classic() +
labs(
title = "Volcano Plot (Day-3 PCI vs sham)",
x = "log2 Fold Change",
y = "-log10(adjusted p-value)"
)
# ---------------------------------------------------
# library requirements
# ---------------------------------------------------
library(GEOquery)
library(DESeq2)
library(readr)
library(data.table)
library(ggrepel)
library(ggplot2)
# Loading the counts
count <-fread("GSE198862_137_HYC_counts.csv.gz", data.table = F)
#set rownames as the first column
row.names(count) <- count[[1]]
count<- count[,-1]
# Downloading the metadata from GEO
gse <- getGEO("GSE198862", GSEMatrix = TRUE)
metadata = pData(gse[[1]])
# creating a sample id column in metadata
metadata$sampleID <- sub("\\s*\\(.*", "",metadata$title)
# filtering low count genes
perc_keep <- 0.8
gene_keep <- rowSums(count > 0) >= ceiling(perc_keep * ncol(count))
count_tbl_low_rm <- count[gene_keep, ]
# subset of metadata
D_20_meta <- metadata[metadata$characteristics_ch1.1 %in% c("treatment: sham","treatment: PCI")& metadata$characteristics_ch1.2 == "time: 20 days", ]
D_20_count <- count_tbl_low_rm[, D_20_meta$sampleID, drop = F]
# metadata for DEseq2
meta <- data.frame(
sampleID = colnames(D_20_count),
Treatment = D_20_meta$`treatment:ch1`
)
# Experimental Design for this study
# Identifying the up & downregulated genes in 3 days sham vs PCI
# PCI == Peritoneal contamination and infection
# sham == healthy group
# DEseq2 DEG
# creating Deseq2 object
obj_deseq2 <- DESeqDataSetFromMatrix(
countData = D_20_count,
colData = meta,
design = ~ Treatment
)
# Add feature annotations
featureData <- data.frame(GeneSymbol = rownames(D_20_count))
mcols(obj_deseq2) <- DataFrame(mcols(obj_deseq2), featureData)
# set reference level and perfrom DE analysis
obj_deseq2$Treatment <- relevel(obj_deseq2$Treatment, ref = "sham")
obj_deseq2 <- DESeq(obj_deseq2)
# Refining the log2change valuse from Deseq2
resLFC <- lfcShrink(obj_deseq2, coef = "Treatment_PCI_vs_sham", type = "apeglm")
res_deseq2 <- resLFC[order(resLFC$padj),]
deg <- as.data.frame(res_deseq2)
# converting log2FC to log10 scale to make plots
deg$logP <- -log10(deg$padj)
# Adding annotations according to the log2FC
deg$significance <- "Not Sig"
# separating up and down regualted genes based on  adj.p-value
deg$significance[deg$padj < 0.05 & deg$log2FoldChange >1 ] <- "up"
deg$significance[deg$padj<0.05 & deg$log2FoldChange < -1] <- "down"
# writing the DEG in a file
fwrite(deg, "DEG_DESeq2_day3.csv", sep = "\t", row.names = T)
# plotting the DEG's
ggplot(deg, aes(x = log2FoldChange, y = logP, color = significance)) +
geom_point(alpha = 0.8, size = 2) +
scale_color_manual(values = c(
"up" = "red",
"down" = "blue",
"Not Sig" = "grey"
)) +
geom_vline(xintercept = c(-1, 1), linetype = "dashed") +
geom_hline(yintercept = -log10(0.05), linetype = "dashed") +
theme_classic() +
labs(
title = "Volcano Plot (Deseq Day-20 PCI vs sham)",
x = "log2 Fold Change",
y = "-log10(adjusted p-value)"
)
# ---------------------------------------------------
# library requirements
# ---------------------------------------------------
library(GEOquery)
library(DESeq2)
library(readr)
library(data.table)
library(ggrepel)
library(ggplot2)
# Loading the counts
count <-fread("GSE198862_137_HYC_counts.csv.gz", data.table = F)
#set rownames as the first column
row.names(count) <- count[[1]]
count<- count[,-1]
# Downloading the metadata from GEO
gse <- getGEO("GSE198862", GSEMatrix = TRUE)
metadata = pData(gse[[1]])
# creating a sample id column in metadata
metadata$sampleID <- sub("\\s*\\(.*", "",metadata$title)
# filtering low count genes
perc_keep <- 0.8
gene_keep <- rowSums(count > 0) >= ceiling(perc_keep * ncol(count))
count_tbl_low_rm <- count[gene_keep, ]
# subset of metadata
D_20_meta <- metadata[metadata$characteristics_ch1.1 %in% c("treatment: sham","treatment: PCI")& metadata$characteristics_ch1.2 == "time: 20 days", ]
D_20_count <- count_tbl_low_rm[, D_20_meta$sampleID, drop = F]
# metadata for DEseq2
meta <- data.frame(
sampleID = colnames(D_20_count),
Treatment = D_20_meta$`treatment:ch1`
)
# Experimental Design for this study
# Identifying the up & downregulated genes in 3 days sham vs PCI
# PCI == Peritoneal contamination and infection
# sham == healthy group
# DEseq2 DEG
# creating Deseq2 object
obj_deseq2 <- DESeqDataSetFromMatrix(
countData = D_20_count,
colData = meta,
design = ~ Treatment
)
# Add feature annotations
featureData <- data.frame(GeneSymbol = rownames(D_20_count))
mcols(obj_deseq2) <- DataFrame(mcols(obj_deseq2), featureData)
# set reference level and perfrom DE analysis
obj_deseq2$Treatment <- relevel(obj_deseq2$Treatment, ref = "sham")
obj_deseq2 <- DESeq(obj_deseq2)
# Refining the log2change valuse from Deseq2
resLFC <- lfcShrink(obj_deseq2, coef = "Treatment_PCI_vs_sham", type = "apeglm")
res_deseq2 <- resLFC[order(resLFC$padj),]
deg <- as.data.frame(res_deseq2)
# converting log2FC to log10 scale to make plots
deg$logP <- -log10(deg$padj)
# Adding annotations according to the log2FC
deg$significance <- "Not Sig"
# separating up and down regualted genes based on  adj.p-value
deg$significance[deg$padj < 0.05 & deg$log2FoldChange >1 ] <- "up"
deg$significance[deg$padj<0.05 & deg$log2FoldChange < -1] <- "down"
# plotting the DEG's
ggplot(deg, aes(x = log2FoldChange, y = logP, color = significance)) +
geom_point(alpha = 0.8, size = 2) +
scale_color_manual(values = c(
"up" = "red",
"down" = "blue",
"Not Sig" = "grey"
)) +
geom_vline(xintercept = c(-1, 1), linetype = "dashed") +
geom_hline(yintercept = -log10(0.05), linetype = "dashed") +
theme_classic() +
labs(
title = "Volcano Plot (Deseq Day-20 PCI vs sham)",
x = "log2 Fold Change",
y = "-log10(adjusted p-value)"
)
gc()
View(deg)
expr_data <- deg
View(expr_data)
#if (!requireNamespace("BiocManager", quietly = TRUE))
#  install.packages("BiocManager")
#BiocManager::install("biomaRt")
#install.packages("dplyr")
library(biomaRt)
library(dplyr)
## to read our file which contains the HNGC symbol
expr_data <- deg
# stringAsFactors= False ensures character columns stay character (not factors).
head(expr_data)
# to view our .csv file
ensembl <- useMart("ensembl", dataset = "hsapiens_gene_ensembl")
# to create connection between ENSEMBL database to get ENSEMBL ID for our HNGC symbols
gene_map <- getBM(
attributes = c("hgnc_symbol", "ensembl_gene_id"),
filters = "hgnc_symbol",
values = expr_data$X,
mart = ensembl
)
expr_data <- deg[,1]
View(deg)
View(featureData)
library(biomaRt)
library(dplyr)
## to read our file which contains the HNGC symbol
expr_data <- deg[,1]
# stringAsFactors= False ensures character columns stay character (not factors).
head(expr_data)
# to view our .csv file
ensembl <- useMart("ensembl", dataset = "hsapiens_gene_ensembl")
# to create connection between ENSEMBL database to get ENSEMBL ID for our HNGC symbols
gene_map <- getBM(
attributes = c("hgnc_symbol", "ensembl_gene_id"),
filters = "hgnc_symbol",
values = expr_data,
mart = ensembl
)
View(gene_map)
library(biomaRt)
library(dplyr)
## to read our file which contains the HNGC symbol
expr_data <- deg[,-1]
# stringAsFactors= False ensures character columns stay character (not factors).
head(expr_data)
# to view our .csv file
ensembl <- useMart("ensembl", dataset = "hsapiens_gene_ensembl")
# to create connection between ENSEMBL database to get ENSEMBL ID for our HNGC symbols
gene_map <- getBM(
attributes = c("hgnc_symbol", "ensembl_gene_id"),
filters = "hgnc_symbol",
values = expr_data,
mart = ensembl
)
View(expr_data)
library(biomaRt)
library(dplyr)
## to read our file which contains the HNGC symbol
expr_data <- deg[,0]
# stringAsFactors= False ensures character columns stay character (not factors).
head(expr_data)
# to view our .csv file
ensembl <- useMart("ensembl", dataset = "hsapiens_gene_ensembl")
# to create connection between ENSEMBL database to get ENSEMBL ID for our HNGC symbols
gene_map <- getBM(
attributes = c("hgnc_symbol", "ensembl_gene_id"),
filters = "hgnc_symbol",
values = expr_data,
mart = ensembl
)
expr_data <- deg[,0]
View(expr_data)
expr_data <- deg(1)
expr_data <- deg[,1]
expr_data <- deg[,-1]
View(expr_data)
if (!requireNamespace("BiocManager", quietly = TRUE))
install.packages("BiocManager")
BiocManager::install("edgeR")
source("scripts/00_setup.R")
getwd()
setwd("C:/Users/nithi_eetauxx/Desktop/DEG/EDA/Sepsis-Associated-Encephalopathy-SAE--temporal-transcriptomics/scripts")
source("scripts/00_setup.R")
setwd("C:/Users/nithi_eetauxx/Desktop/DEG/EDA/Sepsis-Associated-Encephalopathy-SAE--temporal-transcriptomics")
source("scripts/00_setup.R")
rm(list=ls())
source("scripts/00_setup.R")
# Load raw counts
counts <- fread("data/raw/GSE198862_137_HYC_counts.csv.gz", data.table = FALSE)
# Set row names as the first column
rownames(counts) <- counts[[1]]
# removing the duplicate gene column
counts <- counts[, -1]
head(counts)
# Download Metadata
gse <- getGEO("GSE198862", GSEMatrix = TRUE)
setwd("C:/Users/nithi_eetauxx/Desktop/DEG/EDA/Sepsis-Associated-Encephalopathy-SAE--temporal-transcriptomics/data/processed")
# Load raw counts
counts <- fread("data/raw/GSE198862_137_HYC_counts.csv.gz", data.table = FALSE)
setwd("C:/Users/nithi_eetauxx/Desktop/DEG/EDA/Sepsis-Associated-Encephalopathy-SAE--temporal-transcriptomics/data/raw")
# Load raw counts
counts <- fread("data/raw/GSE198862_137_HYC_counts.csv.gz", data.table = FALSE)
